<%# app/views/scxrd_datasets/_gallery.html.erb %>

<!-- SCXRD Gallery Debug: Rendering with <%= @scxrd_datasets.count %> datasets -->

<div class="d-flex justify-content-between align-items-center mb-3">
  <h5 class="mb-0">SCXRD Datasets (<%= @well.scxrd_datasets.count %>)</h5>
  <a class="btn btn-primary btn-sm" href="<%= new_well_scxrd_dataset_path(@well) %>" target="_blank">
    Add SCXRD Dataset
  </a>
</div>

  <% if @scxrd_datasets.any? %>
    <!-- Use the reusable dataset viewer for the first dataset -->
    <%= render 'scxrd_datasets/dataset_viewer', dataset: @scxrd_datasets.first, well: @well, index: 0 %>    <!-- Dataset Navigator -->
    <div class="col-12">
      <div class="card">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span class="fw-bold">SCXRD Datasets (<%= @scxrd_datasets.count %>)</span>
          <a href="<%= new_well_scxrd_dataset_path(@well) %>" class="btn btn-sm btn-primary">
            <i class="fas fa-plus me-1"></i>Add Dataset
          </a>
        </div>
        <div class="card-body p-2">
          <div class="row g-2">
            <% @scxrd_datasets.each_with_index do |dataset, index| %>
              <div class="col-6 col-md-4 col-lg-3">
                <div class="card scxrd-thumbnail <%= 'border-primary' if index == 0 %>" 
                     data-dataset-id="<%= dataset.id %>"
                     style="cursor: pointer; transition: all 0.2s;"
                     onclick="showScxrdDatasetInMain('<%= dataset.id %>', '<%= j(dataset.experiment_name) %>', '<%= well_scxrd_dataset_path(@well, dataset) %>', '<%= @well.id %>', 'scxrd-<%= @scxrd_datasets.first.id %>-0')">
                  <div class="card-body p-2 text-center">
                    <div class="mb-2">
                      <% if dataset.has_first_image? %>
                        <i class="fas fa-camera fa-2x text-primary"></i>
                      <% else %>
                        <i class="fas fa-camera fa-2x text-muted"></i>
                      <% end %>
                    </div>
                    <div class="small fw-bold text-truncate" title="<%= dataset.experiment_name %>">
                      <%= dataset.experiment_name %>
                    </div>
                    <div class="text-muted" style="font-size: 0.75rem;">
                      <%= dataset.date_measured&.strftime("%m/%d/%y") || "No date" %>
                    </div>
                    <div class="mt-1">
                      <% if dataset.has_peak_table? %>
                        <span class="badge bg-success" style="font-size: 0.6rem;">Peak Table</span>
                      <% end %>
                      <% if dataset.has_first_image? %>
                        <span class="badge bg-primary" style="font-size: 0.6rem;">Image</span>
                      <% end %>
                      <span class="badge bg-info" style="font-size: 0.6rem;">Primitive</span>
                    </div>
                  </div>
                </div>
              </div>
            <% end %>
          </div>
        </div>
      </div>
    </div>
  </div>



<% else %>
  <div class="alert alert-info text-center">
    <h6>No SCXRD Datasets</h6>
    <p>No single crystal X-ray diffraction datasets have been uploaded for this well yet.</p>
    <a href="<%= new_well_scxrd_dataset_path(@well) %>" class="btn btn-primary">Add First SCXRD Dataset</a>
  </div>
<% end %>