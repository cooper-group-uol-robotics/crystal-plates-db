<div class="modal fade" id="processingLogModal" tabindex="-1" aria-labelledby="processingLogModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="processingLogModalLabel">
          <i class="bi bi-file-text me-2"></i>Processing Log: <%= dataset.experiment_name %>
        </h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <% if dataset.has_processing_log? %>
          <div class="processing-log-container">
            <div class="d-flex justify-content-between align-items-center mb-3">
              <small class="text-muted">
                <i class="bi bi-clock"></i> 
                Processing completed: <%= dataset.updated_at.strftime('%b %d, %Y at %H:%M:%S') %>
              </small>
              <button type="button" class="btn btn-outline-secondary btn-sm" onclick="copyLogToClipboard()">
                <i class="bi bi-clipboard"></i> Copy Log
              </button>
            </div>
            
            <div class="log-content" id="logContent">
              <% dataset.processing_log_lines.each do |line| %>
                <div class="log-line <%= log_line_class(line) %>">
                  <code><%= h(line) %></code>
                </div>
              <% end %>
            </div>
          </div>
        <% else %>
          <div class="alert alert-info text-center">
            <i class="bi bi-info-circle me-2"></i>
            No processing log available for this dataset.
            <% if dataset.created_at < 1.day.ago %>
              <br><small class="text-muted">This dataset may have been processed before logging was implemented.</small>
            <% end %>
          </div>
        <% end %>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<style>
  .processing-log-container {
    font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
  }
  
  .log-content {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    padding: 1rem;
    max-height: 400px;
    overflow-y: auto;
    font-size: 0.875rem;
  }
  
  .log-line {
    margin-bottom: 0.25rem;
    white-space: pre-wrap;
    word-break: break-all;
  }
  
  .log-line.info code {
    color: #0f5132;
  }
  
  .log-line.warn code {
    color: #664d03;
    font-weight: 500;
  }
  
  .log-line.error code {
    color: #721c24;
    font-weight: bold;
  }
  
  .log-line.debug code {
    color: #6c757d;
  }
  
  .log-line.default code {
    color: #212529;
  }
</style>

<script>
  function copyLogToClipboard() {
    const logContent = document.getElementById('logContent');
    const text = Array.from(logContent.querySelectorAll('.log-line code'))
                     .map(line => line.textContent)
                     .join('\n');
    
    navigator.clipboard.writeText(text).then(() => {
      // Show temporary success message
      const button = event.target.closest('button');
      const originalHtml = button.innerHTML;
      button.innerHTML = '<i class="bi bi-check"></i> Copied!';
      button.classList.remove('btn-outline-secondary');
      button.classList.add('btn-success');
      
      setTimeout(() => {
        button.innerHTML = originalHtml;
        button.classList.remove('btn-success');
        button.classList.add('btn-outline-secondary');
      }, 2000);
    }).catch(() => {
      alert('Failed to copy to clipboard');
    });
  }
</script>