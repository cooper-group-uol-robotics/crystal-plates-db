<%= form_with(model: location, local: true) do |form| %>
  <% if location.errors.any? %>
    <div class="alert alert-danger">
      <h4><%= pluralize(location.errors.count, "error") %> prohibited this location from being saved:</h4>
      <ul>
        <% location.errors.full_messages.each do |message| %>
          <li><%= message %></li>
        <% end %>
      </ul>
    </div>
  <% end %>

  <% 
    # Determine initial state based on location data
    is_carousel_type = (location.carousel_position.present? && location.hotel_position.present?) || 
                       (location.new_record? && location.name.blank?)
    is_special_type = location.name.present?
  %>

  <div class="mb-4">
    <label class="form-label fw-bold">Location Type</label>
    
    <!-- Radio buttons to choose location type -->
    <div class="card mb-3">
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="location_type" id="carousel_location" value="carousel" 
                     <%= is_carousel_type ? 'checked' : '' %>>
              <label class="form-check-label fw-semibold" for="carousel_location">
                <i class="bi bi-grid-3x3-gap me-2"></i>Carousel/Hotel Position
              </label>
            </div>
          </div>
          <div class="col-md-6">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="location_type" id="special_location" value="special" 
                     <%= is_special_type ? 'checked' : '' %>>
              <label class="form-check-label fw-semibold" for="special_location">
                <i class="bi bi-geo-alt me-2"></i>Special Location
              </label>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Carousel position fields -->
    <div id="carousel_fields" class="card mb-3">
      <div class="card-body">
        <div class="row">
          <div class="col-md-6">
            <%= form.label :carousel_position, "Carousel Position", class: "form-label" %>
            <%= form.number_field :carousel_position, class: "form-control", min: 1, max: 10, 
                                  value: location.carousel_position || 1 %>
            <div class="form-text">Select carousel position (1-10)</div>
          </div>
          <div class="col-md-6">
            <%= form.label :hotel_position, "Hotel Position", class: "form-label" %>
            <%= form.number_field :hotel_position, class: "form-control", min: 1, max: 20, 
                                  value: location.hotel_position || 1 %>
            <div class="form-text">Select hotel position (1-20)</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Special location fields -->
    <div id="special_fields" class="card">
      <div class="card-body">
        <%= form.label :name, "Name", class: "form-label" %>
        <%= form.text_field :name, class: "form-control", 
                           placeholder: "Enter location name (e.g., 'imager', 'storage')" %>
        <div class="form-text">Enter a descriptive name for this special location</div>
      </div>
    </div>
  </div>

  <div class="d-flex justify-content-end">
    <%= form.submit class: "btn btn-primary" %>
  </div>
<% end %>

<!-- JavaScript moved to stimulus controller or removed for testing -->
