<div class="container">
  <div class="">
    <div class="mb-2 d-flex justify-content-between align-items-center">
  <div class="form-check form-switch d-inline-block">
    <input class="form-check-input" type="checkbox" id="selectModeSwitch">
    <label class="form-check-label" for="selectModeSwitch">
      Multi select 
      <small class="text-muted" title="Keyboard shortcut: press 's' to toggle">(s)</small>
    </label>
  </div>
  <div>
    <button id="editMultipleWellsBtn" class="btn btn-outline-primary btn-sm d-none me-2" disabled 
            title="Edit selected wells (keyboard shortcut: e)">
      Edit multiple wells
    </button>
    <button id="clearSelectionBtn" class="btn btn-outline-secondary btn-sm d-none" 
            title="Clear all selections (keyboard shortcut: c)"
            onclick="if(window.wellSelector) { window.wellSelector.selectedWells.clear(); window.wellSelector.updateEditButton(); document.querySelectorAll('.well-select-btn.border-info').forEach(b => b.classList.remove('border-info', 'shadow')); }">
      Clear All
    </button>
  </div>
</div>
<div class="d-flex justify-content-center" style="background: #f8f9fa;">
  <div class="border rounded p-2 shadow-sm" id="well-grid-container">
    <div class="d-grid adaptive-well-grid" style="grid-template-columns: 40px repeat(<%= @columns %>, minmax(65px, 1fr)); gap: 8px; max-width: calc(100vw - 40px);">
      <% wells_in_a1 = @wells.select { |w| w.well_row == 1 && w.well_column == 1 } %>
      <% subwell_selector_cols = subwell_grid_columns(wells_in_a1.length) %>
      <div class="d-grid" style="grid-template-columns: repeat(<%= subwell_selector_cols %>, 1fr); gap: 2px;">
      <!-- Subwell header buttons (copied from well A1) -->
      <% wells_in_a1.sort_by(&:subwell).each do |well| %>
        <button type="button" class="btn btn-outline-secondary btn-sm subwell-header-btn p-1"
          data-subwell="<%= well.subwell %>" disabled>
          <%= well.subwell %>
        </button>
      <% end %>
      </div>
      

      <!-- Column header buttons -->
      <% (1..@columns).each do |col| %>
        <button type="button" class="btn btn-outline-secondary btn-sm col-header-btn" data-col="<%= col %>" disabled>
          <%= col %>
        </button>
      <% end %>
    <% (1..@rows).each do |row| %>
            <!-- Row header button -->
        <button type="button" class="btn btn-outline-secondary btn-sm row-header-btn" data-row="<%= row %>" disabled>
          <%= ('A'.ord + row - 1).chr %>
        </button>
      <% (1..@columns).each do |col| %>
        <% wells_in_position = @wells.select { |w| w.well_row == row && w.well_column == col } %>
        <div class="well-position border rounded p-1" style="background: white; min-height: 20px;">
          <% if wells_in_position.any? %>
            <div class="text-center mb-1" style="font-size: 10px; font-weight: bold;">
              <%= wells_in_position.first.well_label  if wells_in_position.length > 1 %>
            </div>
            <% grid_cols = subwell_grid_columns(wells_in_position.length) %>
            <div class="d-grid" style="grid-template-columns: repeat(<%= grid_cols %>, 1fr); gap: 2px;">
              <% wells_in_position.sort_by(&:subwell).each do |well| %>
              <% colors = well_color_class(well) %>
              <button type="button" class="btn btn-sm p-1 well-select-btn"
                style="background-color: <%= colors[:bg_color] %>; color: <%= colors[:text_color] %>; height: 20px; font-size: 9px;"
                data-well-id="<%= well.id %>"
                data-well-label="<%= well.well_label_with_subwell %>"
                data-col="<%= well.well_column %>"
                data-row="<%= well.well_row %>"
                data-subwell="<%= well.subwell %>"
                title="<%= well_tooltip_text(well) %>"
                <%= raw 'data-bs-toggle="modal" data-bs-target="#wellImagesModal"' %>>
                <% if wells_in_position.length > 1 %>
                <%= well.subwell %>
                <% else %>
                <%= wells_in_position.first.well_label %>
                <% end%>
              </button>
              <% end %>
            </div>
          <% else %>
            <div class="text-center text-muted" style="padding-top: 18px; font-size: 10px;">
              Empty
            </div>
          <% end %>
        </div>
      <% end %>
    <% end %>
  </div>
</div>
  </div>
</div>
