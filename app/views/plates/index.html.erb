<% content_for :title, "Plates" %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="mb-0">Plates</h1>
  <div>
    <%= link_to "View Deleted", deleted_plates_path, class: "btn btn-outline-danger me-2" %>
    <%= link_to "New plate", new_plate_path, class: "btn btn-success" %>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <% if @plates.any? %>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>
                <%= link_to plates_path(sort: 'barcode', direction: @sort_column == 'barcode' && @sort_direction == 'asc' ? 'desc' : 'asc', page: params[:page]), 
                            class: "text-decoration-none text-dark" do %>
                  Barcode
                  <% if @sort_column == 'barcode' %>
                    <i class="bi bi-arrow-<%= @sort_direction == 'asc' ? 'up' : 'down' %>"></i>
                  <% else %>
                    <i class="bi bi-arrow-down-up text-muted"></i>
                  <% end %>
                <% end %>
              </th>
              <th>Current Location</th>
              <th>
                <%= link_to plates_path(sort: 'created_at', direction: @sort_column == 'created_at' && @sort_direction == 'asc' ? 'desc' : 'asc', page: params[:page]), 
                            class: "text-decoration-none text-dark" do %>
                  Created At At
                  <% if @sort_column == 'created_at' %>
                    <i class="bi bi-arrow-<%= @sort_direction == 'asc' ? 'up' : 'down' %>"></i>
                  <% else %>
                    <i class="bi bi-arrow-down-up text-muted"></i>
                  <% end %>
                <% end %>
              </th>
              <th style="width: 200px;">Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @plates.each do |plate| %>
              <tr>
                <td>
                  <%= link_to plate.barcode, plate_path(plate), class: "fw-bold text-decoration-none" %>
                </td>
                <td>
                  <% if plate.current_location %>
                    <%= link_to plate.current_location.display_name, location_path(plate.current_location), class: "text-decoration-none" %>
                  <% else %>
                    <span class="text-muted">Not assigned</span>
                  <% end %>
                </td>
                <td>
                  <small class="text-muted"><%= plate.created_at.strftime("%m/%d/%Y") %></small>
                </td>
                <td>
                  <div class="btn-group gap-2" role="group" aria-label="Plate actions">
                  <%= link_to "Edit", edit_plate_path(plate), class: "btn btn-sm btn-outline-secondary rounded" %>
                  <%= button_to "Delete", plate_path(plate), method: :delete,
                    class: "btn btn-sm btn-outline-danger rounded",
                    data: { confirm: "Are you sure you want to delete Plate #{plate.barcode}? It can be restored later." } %>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <div class="text-center py-5">
        <p class="text-muted mb-3">No plates found.</p>
        <%= link_to "Create First Plate", new_plate_path, class: "btn btn-primary" %>
      </div>
    <% end %>

    <% if @plates.respond_to?(:current_page) && @plates.total_pages > 1 %>
      <div class="d-flex justify-content-between align-items-center mt-4">
        <div class="text-muted">
          Showing <%= @plates.offset_value + 1 %> to <%= [@plates.offset_value + @plates.limit_value, @plates.total_count].min %> 
          of <%= @plates.total_count %> plates
        </div>
        <nav aria-label="Page navigation">
          <%= paginate @plates, theme: :bootstrap_4, params: { sort: @sort_column, direction: @sort_direction } %>
        </nav>
      </div>
    <% end %>
  </div>
</div>
