<% content_for :title, "Stock Solutions" %>

<div class="d-flex justify-content-between align-items-center mb-4">
  <h1 class="mb-0">Stock Solutions</h1>
  <div>
    <%= link_to "New Stock Solution", new_stock_solution_path, class: "btn btn-success" %>
  </div>
</div>

<!-- Search Form -->
<div class="card mb-4">
  <div class="card-body">
    <%= form_with url: stock_solutions_path, method: :get, local: true, class: "d-flex gap-2" do |f| %>
      <%= f.text_field :search, value: params[:search], placeholder: "Search by name...", 
                       class: "form-control flex-grow-1" %>
      <%= f.submit "Search", class: "btn btn-primary" %>
      <% if params[:search].present? %>
        <%= link_to "Clear", stock_solutions_path, class: "btn btn-outline-secondary" %>
      <% end %>
    <% end %>
  </div>
</div>

<div class="card">
  <div class="card-body">
    <% if @stock_solutions.any? %>
      <div class="table-responsive">
        <table class="table table-hover">
          <thead>
            <tr>
              <th>Name</th>
              <th>Components</th>
              <th>Used in Wells</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <% @stock_solutions.each do |stock_solution| %>
              <tr>
                <td>
                  <%= link_to stock_solution.display_name, stock_solution_path(stock_solution), 
                              class: "text-decoration-none" %>
                </td>
                <td>
                  <span class="badge bg-secondary"><%= stock_solution.total_components %></span>
                  <% if stock_solution.total_components > 0 %>
                    <div class="small text-muted mt-1">
                      <%= truncate(stock_solution.component_summary, length: 100) %>
                    </div>
                  <% end %>
                </td>
                <td>
                  <span class="badge bg-<%= stock_solution.used_in_wells_count > 0 ? 'success' : 'light' %>">
                    <%= stock_solution.used_in_wells_count %>
                  </span>
                </td>
                <td>
                  <div class="d-flex gap-1">
                    <%= link_to "View", stock_solution_path(stock_solution), class: "btn btn-sm btn-outline-primary" %>
                    <%= link_to "Edit", edit_stock_solution_path(stock_solution), class: "btn btn-sm btn-outline-secondary" %>
                    <% if stock_solution.can_be_deleted? %>
                      <%= button_to "Delete", stock_solution_path(stock_solution), method: :delete,
                                 data: { confirm: "Are you sure?" }, class: "btn btn-sm btn-outline-danger",
                                 style: "display: inline;" %>
                    <% end %>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    <% else %>
      <div class="text-center py-5">
        <% if params[:search].present? %>
          <p class="text-muted mb-3">No stock solutions found matching "<%= params[:search] %>".</p>
          <%= link_to "Clear search", stock_solutions_path, class: "btn btn-outline-primary me-2" %>
        <% else %>
          <p class="text-muted mb-3">No stock solutions found.</p>
        <% end %>
        <%= link_to "Create First Stock Solution", new_stock_solution_path, class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
</div>
